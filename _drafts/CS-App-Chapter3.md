---
title: 程序的机器级表示（3）
category: CS-APP
tags: CS-APP
---

计算机执行**机器代码**，用字节序列编码低级的操作，包括数据处理、管理内存、读写存储设备上的数据、以及利用网络通信。编译器基于编程语言的规则、目标及其的指令集和操作系统遵循的管理，经过一系列阶段生成机器代码。GCC C语言编译器以**汇编代码**的形式产生输出，汇编代码是机器代码的文本表示，给出程序中每一条指令。
<!--more-->

## 程序编码

`gcc -Og -o p p1.c p2.c` gcc是GNU C编译器，编译选项-Og告诉编译器使用会生成符合原始C代码整体结果的机器代码优化登记。

首先，C**预处理器**扩展源代码，插入所有用`#include`命令指定的文件，并扩展所有用`#define`声明指定的宏。其次，**编译器**产生两个源文件的汇编代码，名称分别为p1.s和p2.s。接下来，**汇编器**将汇编代码转化成二进制**目标代码**文件p1.o和p2.o。目标代码是机器代码的一种形式，它包含所有指令的二进制表示，但是还没有填入全局地址。最后**链接器**将两个目标代码文件和实现库函数（例如`printf`）的代码合并，并产生最终可执行代码文件p。

对于机器级编程来说，其中两种抽象尤为重要。第一种是由**指令集体系结果或指令集架构**来定义机器级程序的格式和行为，它定义了处理器状态、指令的格式，以及每条指令对状态的影响。第二种抽象是，机器级程序使用的内存地址都是虚拟地址，提供的内存模型看上去是一个非常大的字节数组。

x86_64的机器代码和原始的C代码差别非常大。一些通常对C语言程序员隐藏的处理器状态都是可见的。

**程序计数器**（PC，在x86_64中用%rip表示）给出将要执行的下一条指令在内存中的地址。

**整数寄存器文件**包含16个命名的位置，分别存储64位的值。

**条件码寄存器**保存着最近执行的算数单元或逻辑指令的状态信息。

一组向量寄存器可以存放一个或多个整数或浮点数值。